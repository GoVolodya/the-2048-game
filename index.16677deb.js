const t="Restart";var e={};class s{static WIN_NUMBER=2048;static STATUS_PLAYING="playing";static STATUS_IDLE="idle";static STATUS_LOSE="lose";static STATUS_WIN="win";static DEFAULT_STATE=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];constructor(t=s.DEFAULT_STATE){this.initialState=t,this.state=this.deepCloneArray(this.initialState),this.setStatus(),this.setScore()}moveLeft(t=!1){if(this.getStatus()!==s.STATUS_PLAYING)return;let e=this.deepCloneArray(s.DEFAULT_STATE);for(let s=0;s<this.state.length;s++){let i=[];for(let t=0;t<this.state[s].length;t++)0!==this.state[s][t]&&i.push(this.state[s][t]);let h=[];for(;i.length>0;){let e=i.shift();if(i.length>0&&e===i[0]){let s=2*e;t||this.setScore(this.getScore()+s),h.push(s),i.shift()}else h.push(e)}let r=0;for(;h.length>0;)e[s][r]=h.shift(),r++}if(!this.compareArrays(this.state,e)){if(t)return!0;this.state=e,this.checkForWin(),this.populateEmptyCell()}if(t)return!1;this.hasOtherMoves()||this.getStatus()===s.STATUS_WIN||this.gameOver()}moveRight(t=!1){if(this.getStatus()!==s.STATUS_PLAYING)return;let e=this.deepCloneArray(s.DEFAULT_STATE);for(let s=0;s<this.state.length;s++){let i=[];for(let t=0;t<this.state[s].length;t++)0!==this.state[s][t]&&i.push(this.state[s][t]);let h=[];for(;i.length>0;){let e=i.pop();if(i.length>0&&e===i[i.length-1]){let s=2*e;t||this.setScore(this.getScore()+s),h.push(s),i.pop()}else h.push(e)}let r=this.state[s].length-1;for(;h.length>0;)e[s][r]=h.shift(),r--}if(!this.compareArrays(this.state,e)){if(t)return!0;this.state=e,this.checkForWin(),this.populateEmptyCell()}if(t)return!1;this.hasOtherMoves()||this.getStatus()===s.STATUS_WIN||this.gameOver()}moveUp(t=!1){if(this.getStatus()!==s.STATUS_PLAYING)return;let e=this.deepCloneArray(s.DEFAULT_STATE);for(let s=0;s<this.state.length;s++){let i=[];for(let t=0;t<this.state[s].length;t++)0!==this.state[t][s]&&i.push(this.state[t][s]);let h=[];for(;i.length>0;){let e=i.shift();if(i.length>0&&e===i[0]){let s=2*e;t||this.setScore(this.getScore()+s),h.push(s),i.shift()}else h.push(e)}let r=0;for(;h.length>0;)e[r][s]=h.shift(),r++}if(!this.compareArrays(this.state,e)){if(t)return!0;this.state=e,this.checkForWin(),this.populateEmptyCell()}if(t)return!1;this.hasOtherMoves()||this.getStatus()===s.STATUS_WIN||this.gameOver()}moveDown(t=!1){if(this.getStatus()!==s.STATUS_PLAYING)return;let e=this.deepCloneArray(s.DEFAULT_STATE);for(let s=0;s<this.state.length;s++){let i=[];for(let t=0;t<this.state[s].length;t++)0!==this.state[t][s]&&i.push(this.state[t][s]);let h=[];for(;i.length>0;){let e=i.pop();if(i.length>0&&e===i[i.length-1]){let s=2*e;t||this.setScore(this.getScore()+s),h.push(s),i.pop()}else h.push(e)}let r=this.state.length-1;for(;h.length>0;)e[r][s]=h.shift(),r--}if(!this.compareArrays(this.state,e)){if(t)return!0;this.state=e,this.checkForWin(),this.populateEmptyCell()}if(t)return!1;this.hasOtherMoves()||this.getStatus()===s.STATUS_WIN||this.gameOver()}getScore(){return this.score}setScore(t=0){this.score=t}getState(){return this.state}setState(t=s.DEFAULT_STATE){this.state=t}getStatus(){return this.status}setStatus(t=s.STATUS_IDLE){this.status=t}start(){this.setStatus(s.STATUS_PLAYING),this.setScore(),this.populateEmptyCells()}restart(){this.setScore(),this.setStatus(),this.state=this.deepCloneArray(this.initialState),this.compareArrays(this.initialState,s.DEFAULT_STATE)&&this.populateEmptyCells()}isFour(){return .1>Math.random()}getNewEmptyCellNumber(){return this.isFour()?4:2}getEmptyCells(){let t=[];for(let e=0;e<this.state.length;e++)for(let s=0;s<this.state[e].length;s++)0===this.state[e][s]&&t.push([e,s]);return t}populateEmptyCell(){let t=this.getEmptyCells(),e=Math.floor(Math.random()*t.length),s=t[e][0],i=t[e][1];this.state[s][i]=this.getNewEmptyCellNumber()}populateEmptyCells(){for(let t=1;t<=2;t++)this.populateEmptyCell()}compareArrays(t,e){for(let s=0;s<t.length;s++)for(let i=0;i<t[s].length;i++)if(void 0===e[s][i]||t[s][i]!==e[s][i])return!1;return!0}hasOtherMoves(){return this.moveDown(!0)||this.moveUp(!0)||this.moveLeft(!0)||this.moveRight(!0)}gameOver(){this.setStatus(s.STATUS_LOSE)}gameWon(){this.setStatus(s.STATUS_WIN)}checkForWin(){for(let t=0;t<this.state.length;t++)for(let e=0;e<this.state[t].length;e++)if(this.state[t][e]===s.WIN_NUMBER){this.gameWon();break}}deepCloneArray(t){return t.map(t=>t.slice())}}const i=new(e=s),h=document.querySelector(".start"),r=document.querySelector(".message-start");function a(){let t=i.getState(),e=document.querySelector(".game-field");for(let s=0;s<t.length;s++)for(let i=0;i<4;i++){let h=e.rows[s].cells[i],r=h.className.split(/\s/).filter(t=>!t.startsWith("field-cell--"));h.className=r.join(" "),0===t[s][i]?h.textContent="":(h.classList.add(`field-cell--${t[s][i]}`),h.textContent=t[s][i])}}function l(){document.querySelector(".game-score").textContent=i.getScore().toString()}function o(t=!1){let e=document.querySelector(".message-lose");t?e.classList.remove("hidden"):e.classList.add("hidden")}function n(t=!1){let e=document.querySelector(".message-win");t?e.classList.remove("hidden"):e.classList.add("hidden")}h.addEventListener("click",e=>{e.target.textContent===t?i.restart():(i.start(),h.textContent=t,r.classList.add("hidden")),o(),n(),a(),l()}),document.addEventListener("keydown",t=>{if(i.getStatus()===e.STATUS_IDLE&&i.setStatus(e.STATUS_PLAYING),i.getStatus()===e.STATUS_PLAYING){switch(t.preventDefault(),t.key){case"ArrowUp":i.moveUp();break;case"ArrowDown":i.moveDown();break;case"ArrowRight":i.moveRight();break;case"ArrowLeft":i.moveLeft()}i.getStatus()===e.STATUS_LOSE&&(o(!0),n()),i.getStatus()===e.STATUS_WIN&&(n(!0),o()),a(),l(),i.hasOtherMoves()||(i.gameOver(),o(!0),n())}});
//# sourceMappingURL=index.16677deb.js.map
